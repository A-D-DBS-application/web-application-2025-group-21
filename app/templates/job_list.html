{% extends "base.html" %}
{% block title %}Vacatures | Job Lijst{% endblock %}
{% block content %}

<h1 class="page-title">Vacatures</h1>

{% set current_sort = sort_by if sort_by is defined else 'relevance' %}

<div class="mode-selector-container">
Â  Â  <h2 class="h5">Kies uw zoekmodus:</h2>
Â  Â  
Â  Â  <a href="{{ url_for('main.jobs_list', sort_by='relevance') }}" 
Â  Â  Â  Â class="mode-btn {% if current_sort == 'relevance' %}active-mode{% else %}inactive-mode{% endif %}">
Â  Â  Â  Â  ðŸ§  IConsult Match (Beste Relevantie)
Â  Â  </a>

Â  Â  <a href="{{ url_for('main.jobs_list', sort_by='title') }}" 
Â  Â  Â  Â class="mode-btn {% if current_sort != 'relevance' %}active-mode{% else %}inactive-mode{% endif %}">
Â  Â  Â  Â  ðŸ”§ Handmatige Filter & Sortering
Â  Â  </a>
</div>

<form method="GET" action="{{ url_for('main.jobs_list') }}" class="filter-form">
Â  Â  
Â  Â  <input type="hidden" name="sort_by" value="{{ current_sort }}">

Â  Â  
Â  Â  {% if current_sort != 'relevance' %}
Â  Â  Â  Â  <p class="form-instruction">Gebruik onderstaande velden om handmatig te filteren. Resultaten worden gesorteerd op Titel (A-Z).</p>

Â  Â  Â  Â  <div class="input-grid manual-filter-grid">
Â  Â  Â  Â  Â  Â  <input type="text" name="q" placeholder="Zoek op Titel/Omschrijving" value="{{ request.args.get('q', '') }}">
Â  Â  Â  Â  Â  Â  <input type="text" name="city" placeholder="Stad" value="{{ request.args.get('city', '') }}">
Â  Â  Â  Â  Â  Â  <input type="text" name="country" placeholder="Land" value="{{ request.args.get('country', '') }}">
Â  Â  Â  Â  Â  Â  <input type="text" name="contract_type" placeholder="Contract type" value="{{ request.args.get('contract_type', '') }}">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="skills-filter">
Â  Â  Â  Â  Â  Â  <label class="skills-label">Skills (filteren - *alle geselecteerde skills zijn vereist*):</label>
Â  Â  Â  Â  Â  Â  <div class="skills-checkboxes">
Â  Â  Â  Â  Â  Â  Â  Â  {% for skill in skills %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="skill-label">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" name="skills" value="{{ skill.id }}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if request.args.getlist('skills') and skill.id|string in request.args.getlist('skills') %}checked{% endif %}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ skill.name }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit" class="btn btn-primary apply-btn">Filters Toepassen</button>
Â  Â  Â  Â  <a href="{{ url_for('main.jobs_list', sort_by='title') }}" class="btn btn-secondary reset-btn">Reset Filters</a>

Â  Â  {% else %}
Â  Â  Â  Â  <p class="alert alert-info">
Â  Â  Â  Â  Â  Â  De **IConsult Match** rangschikt vacatures automatisch op basis van de relevantie voor **uw opgeslagen profiel skills** (Skills 50%, Zoekterm 30%, Recentheid 20%).
Â  Â  Â  Â  </p>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â <input type="text" name="q" placeholder="Verfijn zoekopdracht (wordt meegenomen in de score)" value="{{ request.args.get('q', '') }}">
Â  Â  Â  Â  Â  Â  Â <button type="submit" class="btn btn-primary">Zoek & Herbereken Score</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  {% endif %}

</form>

<div class="job-grid" style="margin-top: 20px;">
Â  {% for job in jobs %}
Â  Â  <div class="job-card">
Â  Â  Â  Â  Â  Â  <h3 class="job-title-link">
Â  Â  Â  Â  <a href="{{ url_for('main.job_detail', job_id=job.id) }}">{{ job.title }}</a>
Â  Â  Â  </h3> 
Â  Â  Â  
Â  Â  Â  {% if job.company %}
Â  Â  Â  Â  <p class="company-name">{{ job.company.company_name_masked }}</p>
Â  Â  Â  {% endif %}

Â  Â  Â  {% if job.location_city or job.country %}
Â  Â  Â  Â  <p class="job-location">
Â  Â  Â  Â  Â  {{ job.location_city }}{% if job.location_city and job.country %}, {% endif %}{{ job.country }}
Â  Â  Â  Â  </p>
Â  Â  Â  {% endif %}

Â  Â  Â  {% if job.contract_type %}
Â  Â  Â  Â  <p class="contract-type-tag">Contract: {{ job.contract_type }}</p>
Â  Â  Â  {% endif %}
Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="required-skills-summary">
Â  Â  Â  Â  Â  {% for skill in job.skills[:3] %}
Â  Â  Â  Â  Â  Â  Â  <span class="required-skill-tag">{{ skill.name }}</span>
Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  {% if job.skills|length > 3 %}
Â  Â  Â  Â  Â  Â  Â  <span class="required-skill-tag more-skills">+{{ job.skills|length - 3 }} meer</span>
Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  {% if current_sort == 'relevance' and job.score is defined %}
Â  Â  Â  Â  <div class="score-summary">
Â  Â  Â  Â  Â  Â  <span class="relevance-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Match: **{{ (job.score * 100) | round(0) }}%**
Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <details class="breakdown-details">
Â  Â  Â  Â  Â  Â  Â  Â  <summary>Score Uitsplitsing (klik voor details)</summary>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="score-breakdown">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set total_score_perc = (job.score * 100) %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-label">Skills Match (max 50%):</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set score_perc = (job.score_breakdown.skill * 100) %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar skill-bar" style="width: {{ score_perc | round(0) }}%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-value">{{ score_perc | round(0) }}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-label">Zoekterm Match (max 30%):</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set score_perc = (job.score_breakdown.text * 100) %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar text-bar" style="width: {{ score_perc | round(0) }}%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-value">{{ score_perc | round(0) }}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-label">Recentheid Bonus (max 20%):</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set score_perc = (job.score_breakdown.recency * 100) %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar recency-bar" style="width: {{ score_perc | round(0) }}%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bar-value">{{ score_perc | round(0) }}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="score-total">Totaal: {{ total_score_perc | round(0) }}%</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </details>
Â  Â  Â  Â  </div>
Â  Â  Â  {% endif %}

Â  Â  Â  <a class="btn btn-secondary" href="{{ url_for('main.job_detail', job_id=job.id) }}">Bekijk Vacature</a>
Â  Â  </div>
Â  {% endfor %}
</div>

{% if not jobs %}
Â  <p>Geen vacatures gevonden.</p>
{% endif %}

<style>
/* ------------------------------------------- */
/* --- Nieuwe & Aangepaste Job Stijlen --- */
/* ------------------------------------------- */
Â  .job-title-link a {
Â  Â  Â  color: #2b63c6 !important; /* Blauw, maakt het een echte link */
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: 700;
Â  Â  Â  font-size: 1.3rem; /* Maakt de titel groter */
Â  Â  Â  display: block;
Â  Â  Â  margin-bottom: 5px;
Â  }
Â  .company-name {
Â  Â  font-size: 1.0rem;
Â  Â  color: #555;
Â  Â  margin-bottom: 8px;
Â  Â  font-weight: 600;
Â  }
Â  .job-location {
Â  Â  font-size: 0.95rem;
Â  Â  color: #4a6fa1;
Â  Â  margin: 6px 0 10px;
Â  Â  padding-bottom: 10px;
Â  Â  border-bottom: 1px dashed #e0e0e0;
Â  }
Â  .contract-type-tag {
Â  Â  font-size: 0.9rem;
Â  Â  background: #f0f4f9;
Â  Â  color: #2b63c6;
Â  Â  padding: 4px 8px;
Â  Â  border-radius: 5px;
Â  Â  display: inline-block;
Â  Â  margin-bottom: 10px;
Â  }

Â  .required-skills-summary {
Â  Â  Â  margin-bottom: 15px;
Â  }
Â  .required-skill-tag {
Â  Â  Â  display: inline-block;
Â  Â  Â  background: #e9f0ff;
Â  Â  Â  color: #2b63c6;
Â  Â  Â  border: 1px solid #bcd0ff;
Â  Â  Â  padding: 4px 8px;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  margin-right: 5px;
Â  Â  Â  margin-bottom: 5px;
Â  }
Â  .more-skills {
Â  Â  Â  background: #dce6f5;
Â  Â  Â  border: 1px solid #c0cff9;
Â  Â  Â  color: #4a6fa1;
Â  }

Â  /* Knoppen voor filters */
Â  .btn-primary {
Â  Â  Â  background: #2b63c6; 
Â  Â  Â  color: white;
Â  Â  Â  border: 1px solid #1a4f99;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-right: 10px;
Â  }
Â  .reset-btn {
Â  Â  Â  color: #555;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  background: #f0f0f0;
Â  }


/* ------------------------------------------- */
/* --- Overige Stijlen (ongewijzigd) --- */
/* ------------------------------------------- */
Â  .page-title { margin-bottom: 20px; }
Â  .job-grid {
Â  Â  display: grid;
Â  Â  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
Â  Â  gap: 20px;
Â  }
Â  .job-card {
Â  Â  background: #ffffff;
Â  Â  border: 1px solid #dce6f5;
Â  Â  border-radius: 12px;
Â  Â  padding: 20px;
Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
Â  Â  transition: transform 0.2s;
Â  Â  display: flex;
Â  Â  flex-direction: column; /* Zorgt ervoor dat Bekijk Vacature altijd onderaan staat */
Â  }
Â  .job-card:hover {
Â  Â  transform: translateY(-3px);
Â  Â  box-shadow: 0 6px 12px rgba(0,0,0,0.1);
Â  }
Â  .relevance-badge {
Â  Â  background: #38c172; /* Groen voor match */
Â  Â  color: white;
Â  Â  padding: 6px 12px;
Â  Â  border-radius: 6px;
Â  Â  font-size: 1rem;
Â  Â  font-weight: 800;
Â  Â  letter-spacing: 0.5px;
Â  Â  display: inline-block;
Â  Â  margin-bottom: 12px;
Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
Â  }
Â  .relevance-badge strong {
Â  Â  Â  font-size: 1.1rem;
Â  }
Â  .btn-secondary {
Â  Â  background: #e9f0ff;
Â  Â  border: 1px solid #bcd0ff;
Â  Â  padding: 8px 14px;
Â  Â  border-radius: 8px;
Â  Â  text-decoration: none;
Â  Â  color: #2b63c6;
Â  Â  font-weight: 600;
Â  Â  margin-top: auto; /* Duwt de knop naar de onderkant van de flex container */
Â  Â  align-self: flex-start; /* Zorgt dat de knop niet uitrekt */
Â  }
Â  
/* --- SCORE BREAKDOWN STYLES (De "Grafiek") --- */
Â  Â  .breakdown-details {
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  padding: 5px 0;
Â  Â  Â  Â  border-top: 1px dashed #e0e0e0;
Â  Â  Â  Â  border-bottom: 1px dashed #e0e0e0;
Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  }
Â  Â  .breakdown-details summary {
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  color: #4a6fa1;
Â  Â  Â  Â  padding: 5px 0;
Â  Â  Â  Â  list-style: none;
Â  Â  }
Â  Â  .breakdown-details summary::-webkit-details-marker {
Â  Â  Â  Â  display: none;
Â  Â  }
Â  Â  .breakdown-details summary::before {
Â  Â  Â  Â  content: 'â–º';
Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  margin-right: 8px;
Â  Â  Â  Â  transition: transform 0.2s;
Â  Â  }
Â  Â  .breakdown-details[open] summary::before {
Â  Â  Â  Â  content: 'â–¼';
Â  Â  Â  Â  transform: rotate(0deg);
Â  Â  }
Â  Â  .score-breakdown {
Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  padding-left: 5px;
Â  Â  }
Â  Â  .bar-item {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: 130px 1fr 40px;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  gap: 5px;
Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  }
Â  Â  .bar-label {
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  color: #555;
Â  Â  }
Â  Â  .progress-bar-container {
Â  Â  Â  Â  height: 10px;
Â  Â  Â  Â  background-color: #e0e6f2;
Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â  .progress-bar {
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  transition: width 0.4s ease;
Â  Â  Â  Â  border-radius: 5px;
Â  Â  }
Â  Â  .skill-bar { background-color: #38c172; } /* Groen */
Â  Â  .text-bar { background-color: #f6993f; } /* Oranje */
Â  Â  .recency-bar { background-color: #6cb2eb; } /* Lichtblauw */
Â  Â  .bar-value {
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  text-align: right;
Â  Â  }
Â  Â  .score-total {
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  padding-top: 5px;
Â  Â  Â  Â  border-top: 1px solid #e0e0e0;
Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  color: #2b63c6;
Â  Â  }

/* --- Modus Selector & Filter Formulier Stijlen --- */
Â  Â  .mode-selector-container {
Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  padding-bottom: 15px;
Â  Â  Â  Â  border-bottom: 1px solid #e0e0e0;
Â  Â  }
Â  Â  .mode-selector-container h2 {
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  color: #333;
Â  Â  }
Â  Â  .mode-btn { 
Â  Â  Â  Â  padding: 12px 25px;
Â  Â  Â  Â  border-radius: 10px; 
Â  Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  margin-right: 15px;
Â  Â  Â  Â  border: 2px solid transparent;
Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  font-size: 1.05rem;
Â  Â  Â  Â  text-decoration: none; /* Belangrijk voor links */
Â  Â  }
Â  Â  .active-mode {
Â  Â  Â  Â  background: #2b63c6; 
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  border-color: #1a4f99;
Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(43, 99, 198, 0.4);
Â  Â  }
Â  Â  .inactive-mode {
Â  Â  Â  Â  background: #f0f4f9; 
Â  Â  Â  Â  color: #2b63c6;
Â  Â  Â  Â  border-color: #dce6f5;
Â  Â  }
Â  Â  .inactive-mode:hover {
Â  Â  Â  Â  background: #e9f0ff;
Â  Â  Â  Â  border-color: #bcd0ff;
Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  }
Â  .filter-form {
Â  Â  padding: 25px; 
Â  Â  border: 1px solid #dce6f5;
Â  Â  border-radius: 12px;
Â  Â  background: #f9fafe;
Â  Â  margin-bottom: 30px;
Â  }
Â  Â  .form-instruction { color: #555; margin-bottom: 15px; font-size: 0.95rem; }
Â  Â  .manual-filter-grid {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .filter-form input[type="text"] {
Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  border: 1px solid #dce6f5;
Â  Â  }
Â  Â  .input-group { gap: 15px; display: flex; }
Â  Â  .input-group input[type="text"] { flex-grow: 1; padding: 12px; margin: 0;}
Â  Â  .alert-info { padding: 18px; margin-bottom: 25px; font-size: 1.05rem; background: #d9e9ff; border-radius: 8px;}
Â  Â  .skills-filter { margin-top: 15px; margin-bottom: 20px;}
Â  Â  .skills-label { font-weight: 700; display: block; margin-bottom: 10px; color: #333; }
Â  Â  .skills-checkboxes { display: flex; flex-wrap: wrap; gap: 10px; }
Â  Â  .skill-label {
Â  Â  Â  Â  display: flex; align-items: center; background: #e9f0ff; border: 1px solid #bcd0ff;
Â  Â  Â  Â  padding: 6px 10px; border-radius: 20px; font-size: 0.9rem; cursor: pointer;
Â  Â  }
Â  Â  .skill-label input[type="checkbox"] { margin-right: 5px; }
Â  Â  .apply-btn { margin-top: 10px; }
</style>

{% endblock %}