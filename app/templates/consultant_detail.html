{% extends "base.html" %}
{% block title %}Consultant detail{% endblock %}
{% block content %}
  <h1>{{ profile.display_name_masked }}</h1>
  {# --------- Profielfoto --------- #}
  {% if profile.profile_image %}
    <img
      src="{{ profile.profile_image }}"
      alt="Profile picture"
      style="width:140px;height:140px;border-radius:50%;object-fit:cover;margin-bottom:15px;"
    >
  {% else %}
    <img
      src="{{ url_for('static', filename='img/default-avatar.png') }}"
      alt="No profile picture"
      style="width:140px;height:140px;border-radius:50%;object-fit:cover;margin-bottom:15px;"
    >
  {% endif %}

  {% if profile.headline %}
    <p><i>{{ profile.headline }}</i></p>
  {% endif %}

  <h3>Skills</h3>
  {% if profile.skills and profile.skills|length > 0 %}
    <ul>
      {% for skill in profile.skills %}
        <li>{{ skill.name }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><i>No skills specified.</i></p>
  {% endif %}

  <p>
    <small>
      {{ profile.location_city }}
      {% if profile.location_city and profile.country %}, {% endif %}
      {{ profile.country }}
    </small>
  </p>
<div class="card">
    <h2>Contact details</h2>
   
    {# 1. Controleert: Is de bezoeker een Bedrijf? #}
    {% if user and user.role == UserRole.company %}
       
        {# Toon contactgegevens indien ONTGRENDELD of de EIGENAAR #}
        {% if is_unlocked or is_owner %}
            <p><strong>E-mail:</strong> {{ profile.contact_email or "Not filled in" }}</p>
            <p><strong>Phone:</strong> {{ profile.phone_number or "Not filled in" }}</p>
           
            {% if profile.cv_document %}
                <p>
                    <strong>CV:</strong>
                    <a href="{{ profile.cv_document }}" target="_blank">
                        View / download CV
                    </a>
                </p>
            {% else %}
                <p><strong>CV:</strong> Not filled in</p>
            {% endif %}

            {% if is_unlocked %}
                <p style="color: green;">âœ… These contact details have been released and are permanently visible.</p>
            {% endif %}
       
        {# Toon UNLOCK-KNOP indien niet ontgrendeld #}
        {% else %}
            <p>The contact details of this consultant are **hidden**.</p>
            <p><strong>CV:</strong> Verborgen</p>
            <a href="{{ url_for('main.unlock_consultant', profile_id=profile.id) }}" class="btn" onclick="return confirm('Weet u zeker dat u de contactgegevens wilt vrijgeven?')">
                ðŸ”’ Unlock contact details (MVP Button)
            </a>
            <p><small>By clicking this button, the contact details will become permanently visible to your company.</small></p>
        {% endif %}
       
    {# 2. Toon consultant's eigen contactinfo (als ze ingelogd zijn op hun eigen profiel)-> is dit niet overbodig? #}
    {% elif is_owner %}
        <p><strong>E-mail:</strong> {{ profile.contact_email or "Niet ingevuld" }} (Zichtbaar voor u als eigenaar)</p>
        <p><strong>Phone:</strong> {{ profile.phone_number or "Niet ingevuld" }} (Zichtbaar voor u als eigenaar)</p>
        {% if profile.cv_document %}
            <p>
                <strong>CV:</strong>
                <a href="{{ profile.cv_document }}" target="_blank">
                    View / download CV
                </a>
            </p>
        {% else %}
            <p><strong>CV:</strong> Not filled in</p>
        {% endif %}
       
    {# 3. Fallback: Toon de login/rol-vereiste #}
    {% else %}
        <p>Log in as a **Company** to view and unlock the contact details.</p>
    {% endif %}
</div>

{# ðŸ”¹ Collaborate-vraag + groene knop:
     - alleen als user company is
     - consultant is unlocked
     - consultant is nog beschikbaar #}
  {% if user and user.role == UserRole.company and is_unlocked and profile.availability %}
    <div class="card collaborate-card" style="margin-top:20px;">
        <h3>Collaborate?</h3>
        <p>
            You have unlocked this consultant's contact details.<br>
            Do you want to start a collaboration with this consultant?
        </p>
        <form method="post" action="{{ url_for('main.collaborate_with_consultant', profile_id=profile.id) }}">
            <button type="submit" class="btn btn-success">
                Yes, collaborate
            </button>
        </form>
    </div>
  {% endif %}

  <style>
    .btn-success {
        background: #28a745;
        color: white;
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        text-decoration: none;
    }

    .collaborate-card {
        border: 1px solid #cfe9d5;
        background: #f3fff5;
        border-radius: 14px;
        padding: 18px;
    }
  </style>

{% endblock %}