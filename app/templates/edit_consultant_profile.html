{% extends "base.html" %}
{% block title %}Edit Profile{% endblock %}

{% block content %}
<h1>Edit consultant profile</h1>

<form method="post" enctype="multipart/form-data" class="profile-form">

    <!-- NAME -->
    <label class="field-label">
        Full name:
        <input
            type="text"
            id="display_name"
            name="display_name"
            value="{{ profile.display_name_masked or '' }}"
            required
        >
    </label>

    <!-- CITY -->
    <label class="field-label">
        City:
        <input
            type="text"
            id="location_city"
            name="location_city"
            value="{{ profile.location_city or '' }}"
        >
    </label>

    <!-- COUNTRY -->
    <label class="field-label">
        Country:
        <input
            type="text"
            id="country"
            name="country"
            value="{{ profile.country or '' }}"
        >
    </label>

    <!-- HEADLINE -->
    <label class="field-label">
        Headline:
        <input
            type="text"
            id="headline"
            name="headline"
            value="{{ profile.headline or '' }}"
        >
    </label>

    <!-- YEARS OF EXPERIENCE -->
    <label class="field-label">
        Years of experience:
        <input
            type="number"
            id="years_experience"
            name="years_experience"
            min="0"
            value="{{ profile.years_experience if profile.years_experience is not none else '' }}"
        >
    </label>

    <hr>

    <h3>Documents</h3>

    {% if profile.profile_image %}
        <div class="current-file">
            <strong>Current profile picture:</strong><br>
            <img src="{{ profile.profile_image }}" alt="Profile picture" class="current-profile-image">
        </div>
    {% endif %}

    <!-- PROFILE PICTURE -->
    <label class="field-label">
        Profile picture:
        <input
            type="file"
            id="profile_image"
            name="profile_image"
            accept="image/*"
        >
    </label>

    {% if profile.cv_document %}
        <div class="current-file">
            <strong>Current CV:</strong>
            <a href="{{ profile.cv_document }}" target="_blank">Open current CV</a>
        </div>
    {% endif %}

    <!-- CV DOCUMENT -->
    <label class="field-label">
        CV document:
        <input
            type="file"
            id="cv_document"
            name="cv_document"
            accept=".pdf,.doc,.docx"
        >
    </label>

    <hr>

    <h3>Contact information</h3>

    <!-- EMAIL -->
    <label class="field-label">
        Email address:
        <input
            type="email"
            id="contact_email"
            name="contact_email"
            value="{{ profile.contact_email or '' }}"
        >
    </label>

    <!-- PHONE -->
    <label class="field-label">
        Phone number:
        <input
            type="tel"
            id="phone_number"
            name="phone_number"
            value="{{ profile.phone_number or '' }}"
        >
    </label>

    <hr>

    <h3>Availability</h3>

    <!-- AVAILABILITY -->
    <label class="field-label">
        Status:
        <select id="availability_status" name="availability_status">
            <option value="available" {% if profile.availability %}selected{% endif %}>
                Available for new jobs
            </option>
            <option value="unavailable" {% if not profile.availability %}selected{% endif %}>
                Unavailable (not searching right now)
            </option>
        </select>
    </label>

    <hr>

    <button class="btn" type="submit">Save changes</button>
</form>

<!-- FIELD HELPER POPUP -->
<div id="field-helper" class="field-helper">
    <div class="field-helper-title">
        <span id="field-helper-label">Field guide</span>
    </div>
    <div id="field-helper-text" class="field-helper-text">
        Click a field to get instructions.
    </div>
</div>

<script>
(function () {
    const helperText = document.getElementById("field-helper-text");
    const helperLabel = document.getElementById("field-helper-label");

    function guide(label, text) {
        helperLabel.textContent = label;
        helperText.textContent = text;
    }

    function bind(fieldId, label, text) {
        const field = document.getElementById(fieldId);
        if (!field) return;
        field.addEventListener("focus", () => guide(label, text));
    }

    bind("display_name", "Full Name",
        "Write your full professional name. This name is shown once a company unlocks your profile.");

    bind("location_city", "City",
        "Your city helps us calculate distance-based relevance.");

    bind("country", "Country",
        "Enter the country you are based in. This influences visibility and matching accuracy.");

    bind("headline", "Headline",
        "Short summary of your role. Example: “Senior Cloud Engineer” or “Data Analyst Consultant”.");

    bind("years_experience", "Experience",
        "Your years of experience impact your relevance matching. Enter only whole numbers.");

    bind("profile_image", "Profile Picture",
        "Upload a professional photo. This is visible only after you are unlocked.");

    bind("cv_document", "CV Upload",
        "Upload a CV with your skills and experience. Your CV will be made available after you have been unlocked.";

    bind("contact_email", "Email",
        "Companies will contact you via this email once unlocked.");

    bind("phone_number", "Phone Number",
        "Companies will contact you via this email once unlocked.");

    bind("availability_status", "Availability",
        "Indicate whether you are open for new opportunities now.");
})();
</script>

{% endblock %}
