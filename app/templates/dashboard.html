{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<h1>Dashboard</h1>

<div class="card">
    <h2>Profile Details</h2>

    <p><strong>Role:</strong> {{ user.role.value }}</p>

    {% if user.role == UserRole.consultant %}
        <hr>

        <!-- HEADER LAYOUT -->
        <div class="profile-header-grid">

            <div class="profile-media">
                {% if profile.profile_image %}
                    <img src="{{ profile.profile_image }}" class="profile-image" alt="Profile Picture">
                {% else %}
                    <img src="{{ url_for('static', filename='img/default-avatar.png') }}"
                         class="profile-image" alt="No profile picture">
                {% endif %}
            </div>

            <div class="profile-details">
                <h3>Consultant Details</h3>

                <p><strong>Name:</strong> {{ profile.display_name_masked }}</p>

                {% if profile.years_experience is not none %}
                    <p><strong>Experience:</strong> {{ profile.years_experience }} year{% if profile.years_experience != 1 %}s{% endif %}</p>
                {% endif %}

                <p><strong>Location:</strong> {{ profile.location_city }} , {{ profile.country }}</p>
                <p><strong>Headline:</strong> {{ profile.headline or "No headline" }}</p>

                <p class="profile-skills">
                    <strong>Skills:</strong>
                    {% if profile.skills %}
                        {{ profile.skills | map(attribute='name') | join(', ') }}
                    {% else %}
                        No skills selected
                    {% endif %}
                </p>
            </div>
        </div>

        <hr>

        <h3>Documents</h3>
        {% if profile.cv_document %}
            <p><strong>CV:</strong> <a href="{{ profile.cv_document }}" target="_blank">View / Download</a></p>
        {% else %}
            <p><strong>CV:</strong> Not yet added</p>
        {% endif %}

        <hr>

        <h3>Contact & Availability</h3>
        <div class="contact-details-grid">

            <div>
                <p><strong>Email:</strong> {{ profile.contact_email or "Not filled in" }}</p>
            </div>

            <div>
                <p><strong>Phone:</strong> {{ profile.phone_number or "Not filled in" }}</p>
            </div>

            <div>
                <p><strong>Availability:</strong>  
                    {% if profile.availability %}
                        <span class="status available">Available</span>
                    {% else %}
                        <span class="status unavailable">Unavailable</span>
                    {% endif %}
                </p>
            </div>
        </div>

        {% if consultant_active_collaborations %}
            <hr>
            <h3>Active Collaborations</h3>
            <p>
                {% for collab in consultant_active_collaborations %}
                    {{ collab.company.company_name_masked }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}

        <div class="dashboard-actions">
            <a class="btn" href="{{ url_for('main.edit_consultant_profile') }}">Edit Profile</a>
            <a class="btn" href="{{ url_for('main.edit_consultant_skills') }}">Edit Skills</a>
        </div>
    {% endif %}

    {% if user.role == UserRole.company %}
        <hr>
        <h3>Company Details</h3>

        <p><strong>Company name:</strong> {{ company.company_name_masked }}</p>
        <p><strong>Sector:</strong> {{ company.industries or "Not filled in" }}</p>

        <hr>
        <h3>Contact Information</h3>

        <div class="contact-details-grid">
            <div>
                <p><strong>Email:</strong> {{ company.contact_email or "Not filled in" }}</p>
            </div>
            <div>
                <p><strong>Phone:</strong> {{ company.phone_number or "Not filled in" }}</p>
            </div>
        </div>

        {% if company_active_collaborations %}
            <hr>
            <h3>Active Collaborations</h3>
            <p>
                {% for collab in company_active_collaborations %}
                    <a href="{{ url_for('main.consultant_detail', profile_id=collab.consultant.id) }}">
                        {{ collab.consultant.display_name_masked }}
                    </a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}

        <div class="dashboard-actions">
            <a class="btn" href="{{ url_for('main.edit_company_profile') }}">Edit Profile</a>
            <a class="btn" href="{{ url_for('main.job_new') }}">New Job Post</a>
            <a class="btn" href="{{ url_for('main.company_jobs_list') }}">My Job Posts</a>
        </div>
    {% endif %}
</div>

{% endblock %}
